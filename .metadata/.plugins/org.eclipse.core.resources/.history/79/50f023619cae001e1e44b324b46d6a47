package Observer;

import java.util.ArrayList;
import java.util.Collection;

//interface
interface ITelefoneListener extends java.util.EventListener {
	void telefoneTocou(TelefoneEvent e);
	void telefoneAtendido(TelefoneEvent e);
}

class TelefoneEvent extends java.util.EventObject {
	public TelefoneEvent(Telefone source) {
		super(source);
	}
}

class TelefoneAdapter implements ITelefoneListener {
	void telefoneTocou(TelefoneEvent e) {	}
	void telefoneAtendido(TelefoneEvent e) {}
}

class Telefone {
  private Collection <ITelefoneListener> telefoneListeners = new ArrayList<ITelefoneListener>();

  // método de suporte para testar a solução
  public void tocaFone() {
      disparaTelefoneTocou();
  }

  // método de suporte para testar a solução
  public void atendeFone() {
      disparaTelefoneAtendido();
  }

  public synchronized void addTelefoneListener(ITelefoneListener l) {
      if(!telefoneListeners.contains(l)) {
          telefoneListeners.add(l);
      }
  }

  public synchronized void 
          removeTelefoneListener(ITelefoneListener l) {

      telefoneListeners.remove(l);
  }

  private void disparaTelefoneTocou() {
      Collection <ITelefoneListener> tl;
      synchronized (this) {
          // Clonar para evitar problemas de sincronização
          // durante a propagação
          tl = (Collection)(((ArrayList)telefoneListeners).clone());
      }
      TelefoneEvent evento = new TelefoneEvent(this);                
      for (ITelefoneListener t : tl) {
      	t.telefoneTocou(evento);
      }
  }
          

  // disparaTelefoneAtendido() é semelhante a disparaTelefoneTocou()
  // Exercício: Que design pattern poderia ser usado para fatorar
  // o código comum?
  private void disparaTelefoneAtendido() {
      Collection <TelefoneListener> tl;
      synchronized (this) {
          tl = (Collection)(((ArrayList)telefoneListeners).clone());
      }
      TelefoneEvent evento = new TelefoneEvent(this);
      for (TelefoneListener t : tl) {
      	t.telefoneAtendido(evento);
      }        
  }
}

public class ExemploObserver {

}
